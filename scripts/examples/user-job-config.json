{
  "domain": "user",
  "job_name": "用户事件处理作业",
  "description": "处理用户登录、购买、浏览等事件，关联用户维度数据",
  
  "source_table": {
    "name": "user_event_source",
    "fields": [
      {"name": "domain", "type": "STRING", "comment": "业务域"},
      {"name": "type", "type": "STRING", "comment": "事件类型"},
      {"name": "timestamp", "type": "BIGINT", "comment": "事件时间戳"},
      {"name": "eventId", "type": "STRING", "comment": "事件ID"},
      {"name": "payload", "type": "STRING", "comment": "载荷数据"},
      {"name": "version", "type": "STRING", "comment": "数据版本"},
      {"name": "source", "type": "STRING", "comment": "来源系统"}
    ]
  },
  
  "dim_tables": [
    {
      "name": "user_dim",
      "alias": "d1",
      "key_field": "user_id",
      "join_field": "userId",
      "fields": [
        {"name": "user_id", "type": "STRING", "comment": "用户ID"},
        {"name": "user_name", "type": "STRING", "comment": "用户名称"},
        {"name": "user_level", "type": "INT", "comment": "用户等级"},
        {"name": "register_time", "type": "TIMESTAMP(3)", "comment": "注册时间"},
        {"name": "last_login_time", "type": "TIMESTAMP(3)", "comment": "最后登录时间"}
      ],
      "output_fields": ["user_name", "user_level"]
    }
  ],
  
  "result_table": {
    "name": "user_wide_table",
    "key_field": "event_id",
    "fields": [
      {"name": "event_id", "type": "STRING", "comment": "事件ID"},
      {"name": "domain", "type": "STRING", "comment": "业务域"},
      {"name": "type", "type": "STRING", "comment": "事件类型"},
      {"name": "user_id", "type": "STRING", "comment": "用户ID"},
      {"name": "user_name", "type": "STRING", "comment": "用户名称"},
      {"name": "user_level", "type": "INT", "comment": "用户等级"},
      {"name": "business_data", "type": "STRING", "comment": "业务数据"},
      {"name": "event_time", "type": "TIMESTAMP(3)", "comment": "事件时间"},
      {"name": "process_time", "type": "TIMESTAMP(3)", "comment": "处理时间"}
    ],
    "insert_fields": ["event_id", "domain", "type", "user_id", "user_name", "user_level", "business_data", "event_time", "process_time"],
    "placeholders": ["?", "?", "?", "?", "?", "?", "?", "?", "?"],
    "field_types": ["String", "String", "String", "String", "String", "Int", "String", "Timestamp", "Timestamp"],
    "java_types": ["String", "String", "String", "String", "String", "Integer", "String", "Timestamp", "Timestamp"],
    "select_fields": [
      "JSON_VALUE(s.payload, '$.userId') as user_id",
      "COALESCE(d1.user_name, 'Unknown') as user_name", 
      "COALESCE(d1.user_level, 0) as user_level",
      "s.payload as business_data",
      "s.event_time",
      "s.proc_time as process_time"
    ]
  },
  
  "event_types": ["user_login", "user_purchase", "user_view"],
  
  "event_fields": [
    {"name": "userId", "java_type": "String"},
    {"name": "eventType", "java_type": "String"},
    {"name": "timestamp", "java_type": "Long"},
    {"name": "sessionId", "java_type": "String"},
    {"name": "ip", "java_type": "String"},
    {"name": "device", "java_type": "String"}
  ],
  
  "event_processing_fields": {
    "user_login": [
      {"name": "user_id", "source": "userId", "type": "Text"},
      {"name": "login_time", "source": "loginTime", "type": "Long"},
      {"name": "device", "source": "device", "type": "Text"},
      {"name": "ip", "source": "ip", "type": "Text"}
    ],
    "user_purchase": [
      {"name": "user_id", "source": "userId", "type": "Text"},
      {"name": "order_id", "source": "orderId", "type": "Text"},
      {"name": "product_id", "source": "productId", "type": "Text"},
      {"name": "amount", "source": "amount", "type": "Double"},
      {"name": "quantity", "source": "quantity", "type": "Int"}
    ],
    "user_view": [
      {"name": "user_id", "source": "userId", "type": "Text"},
      {"name": "page_id", "source": "pageId", "type": "Text"},
      {"name": "duration", "source": "duration", "type": "Long"}
    ]
  },
  
  "business_config": {
    "cache.ttl": "300",
    "batch.size": "100",
    "timeout": "30000"
  }
}
