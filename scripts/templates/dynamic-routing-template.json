{
  "template_version": "1.0",
  "description": "动态路由配置模板 - 支持热部署和新子类型添加",
  "domain": "${DOMAIN}",
  "job_name": "${JOB_NAME}",
  
  "routing_configs": [
    {
      "event_type": "${DOMAIN}_add",
      "processor_class": "com.flink.realtime.processor.impl.${DOMAIN_TITLE}AddProcessor",
      "output_config": {
        "sinks": ["${DOMAIN}_wide_table", "metrics_topic"],
        "enable_alert": false,
        "enable_audit": true
      },
      "priority": 100,
      "enabled": true,
      "hot_deployable": true,
      "version": "1.0"
    },
    {
      "event_type": "${DOMAIN}_fix", 
      "processor_class": "com.flink.realtime.processor.impl.${DOMAIN_TITLE}FixProcessor",
      "output_config": {
        "sinks": ["${DOMAIN}_wide_table", "metrics_topic"],
        "enable_alert": true,
        "enable_audit": true
      },
      "priority": 100,
      "enabled": true,
      "hot_deployable": true,
      "version": "1.0"
    },
    {
      "event_type": "${DOMAIN}_delete",
      "processor_class": "com.flink.realtime.processor.impl.${DOMAIN_TITLE}DeleteProcessor", 
      "output_config": {
        "sinks": ["${DOMAIN}_wide_table", "audit_topic"],
        "enable_alert": false,
        "enable_audit": true
      },
      "priority": 90,
      "enabled": false,
      "hot_deployable": true,
      "version": "1.0",
      "comment": "新增事件类型，默认禁用"
    }
  ],
  
  "event_type_templates": {
    "add_template": {
      "payload_fields": [
        {"name": "userId", "type": "String", "required": true},
        {"name": "questionId", "type": "String", "required": true},
        {"name": "wrongRecordId", "type": "String", "required": false},
        {"name": "subject", "type": "String", "required": false},
        {"name": "subjectName", "type": "String", "required": false},
        {"name": "patternId", "type": "String", "required": false},
        {"name": "wrongTime", "type": "Long", "required": false},
        {"name": "createTime", "type": "Long", "required": false}
      ],
      "processing_logic": "create_new_record",
      "output_fields": [
        "id", "wrong_id", "user_id", "subject", "subject_name", 
        "question_id", "pattern_id", "collect_time", "event_id", "event_type"
      ]
    },
    "fix_template": {
      "payload_fields": [
        {"name": "userId", "type": "String", "required": true},
        {"name": "questionId", "type": "String", "required": true},
        {"name": "wrongRecordId", "type": "String", "required": true},
        {"name": "fixTime", "type": "Long", "required": true},
        {"name": "fixResult", "type": "String", "required": true},
        {"name": "attempts", "type": "Integer", "required": false},
        {"name": "timeCost", "type": "Long", "required": false}
      ],
      "processing_logic": "update_existing_record",
      "output_fields": [
        "fix_id", "fix_time", "fix_result", "fix_result_desc"
      ]
    },
    "delete_template": {
      "payload_fields": [
        {"name": "userId", "type": "String", "required": true},
        {"name": "questionId", "type": "String", "required": true},
        {"name": "wrongRecordId", "type": "String", "required": true},
        {"name": "deleteReason", "type": "String", "required": false},
        {"name": "deleteTime", "type": "Long", "required": true}
      ],
      "processing_logic": "mark_deleted",
      "output_fields": [
        "is_deleted", "delete_time", "delete_reason"
      ]
    }
  },
  
  "hot_deployment": {
    "config_source": "mysql",
    "refresh_interval": "30s",
    "config_table": "flink_routing_config",
    "enable_version_control": true,
    "rollback_support": true
  },
  
  "new_event_type_guide": {
    "step1": "复制对应的template配置",
    "step2": "修改event_type和processor_class",
    "step3": "更新payload_fields和output_fields",
    "step4": "设置enabled=true启用",
    "step5": "通过config_source热部署生效"
  },
  
  "monitoring": {
    "metrics": [
      "event_processing_rate",
      "hot_deployment_success_rate", 
      "new_event_type_adoption_rate",
      "processor_performance"
    ],
    "alerts": [
      "hot_deployment_failure",
      "unknown_event_type",
      "processor_exception"
    ]
  }
}
