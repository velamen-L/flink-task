# ğŸš€ Flink AI Gradle æ’ä»¶

## ğŸ“– é¡¹ç›®æ¦‚è¿°

Flink AI Gradle æ’ä»¶æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„æ™ºèƒ½åŒ–Flink SQLå¼€å‘å·¥å…·ï¼Œæä¾›ä»éœ€æ±‚æè¿°åˆ°ç”Ÿäº§éƒ¨ç½²çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆã€‚

### ğŸ¯ æ ¸å¿ƒä»·å€¼

- **ğŸ”„ æ™ºèƒ½ç”Ÿæˆ**: åŸºäºç»“æ„åŒ–è¾“å…¥è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†Flink SQLä½œä¸š
- **ğŸ“Š çŸ¥è¯†ç®¡ç†**: ç»´æŠ¤ä¼ä¸šçº§ERå›¾çŸ¥è¯†åº“ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **ğŸ” è´¨é‡ä¿éšœ**: å¤šç»´åº¦éªŒè¯ï¼Œç¡®ä¿ç”Ÿæˆä»£ç çš„æ­£ç¡®æ€§å’Œæ€§èƒ½
- **âš¡ æ•ˆç‡æå‡**: å°†ä¼ ç»Ÿ2-3å¤©çš„å¼€å‘å‘¨æœŸç¼©çŸ­è‡³30åˆ†é’Ÿ
- **ğŸ“ˆ æ ‡å‡†åŒ–**: ç»Ÿä¸€Flink SQLå¼€å‘è§„èŒƒï¼Œæå‡ä»£ç è´¨é‡

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```mermaid
graph TB
    A[è¯·æ±‚æ–‡ä»¶ request.md] --> B[Flink SQLç”Ÿæˆå™¨]
    A --> C[ERçŸ¥è¯†åº“ç®¡ç†å™¨]
    A --> D[æ•°æ®éªŒè¯å™¨]
    
    B --> E[SQLæ–‡ä»¶]
    B --> F[éƒ¨ç½²è„šæœ¬]
    B --> G[ä½œä¸šé…ç½®]
    
    C --> H[ERå›¾æ›´æ–°]
    C --> I[å†²çªæ£€æµ‹]
    C --> J[å¢å¼ºå›¾è¡¨]
    
    D --> K[éªŒè¯æŠ¥å‘Š]
    D --> L[æ€§èƒ½åˆ†æ]
    D --> M[ä¼˜åŒ–å»ºè®®]
    
    E --> N[ç”Ÿäº§éƒ¨ç½²]
    F --> N
    G --> N
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é¡¹ç›®é…ç½®

åœ¨ `build.gradle` ä¸­é…ç½®æ’ä»¶ï¼š

```gradle
plugins {
    id 'com.flink.ai.generator'
}

flinkAiGenerator {
    requestFile = file('job/wrongbook/flink-sql-request-v3.md')
    outputDir = layout.buildDirectory.dir('flink-ai-output')
    knowledgeBaseDir = file('er-knowledge-base')
    domain = 'wrongbook'
    verbose = true
}
```

### 2. åˆ›å»ºè¯·æ±‚æ–‡ä»¶

åˆ›å»º `job/wrongbook/flink-sql-request-v3.md`ï¼š

```markdown
# é”™é¢˜æœ¬ä¿®æ­£è®°å½•å®æ—¶å®½è¡¨ä½œä¸š

## ğŸ“‹ ä½œä¸šåŸºæœ¬ä¿¡æ¯
job_info:
  name: "é”™é¢˜æœ¬ä¿®æ­£è®°å½•å®æ—¶å®½è¡¨"
  domain: "wrongbook"
  event_type: "fix"
  # ... å…¶ä»–é…ç½®

## ğŸ—„ï¸ æºè¡¨é…ç½®
# BusinessEvent + WrongbookFixPayload

## ğŸ”— ç»´è¡¨é…ç½®  
# ç»´è¡¨åˆ—è¡¨ï¼ˆä»…è¿‡æ»¤æ¡ä»¶ï¼‰

## ğŸ¯ ç»“æœè¡¨é…ç½®
# ç»“æœè¡¨DDL

## ğŸ”„ å­—æ®µæ˜ å°„é…ç½®
# å­—æ®µæ˜ å°„è§„åˆ™

## ğŸ—ºï¸ ERå›¾å®šä¹‰
# å…³è”å…³ç³»å®šä¹‰
```

### 3. æ‰§è¡Œç”Ÿæˆ

```bash
# å®Œæ•´å·¥ä½œæµï¼ˆæ¨èï¼‰
gradle flinkAiWorkflow

# æˆ–åˆ†æ­¥æ‰§è¡Œ
gradle generateFlinkSql
gradle updateERKnowledgeBase  
gradle validateFlinkSqlData
```

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### ğŸ”„ Flink SQLè‡ªåŠ¨ç”Ÿæˆ

- **æ™ºèƒ½è§£æ**: è§£æç»“æ„åŒ–è¾“å…¥æ–‡ä»¶
- **æ ‡å‡†åŒ–SQL**: ç”Ÿæˆç¬¦åˆFlink SQLè§„èŒƒçš„ä»£ç 
- **æ€§èƒ½ä¼˜åŒ–**: è‡ªåŠ¨ä¼˜åŒ–JOINé¡ºåºå’ŒæŸ¥è¯¢æ€§èƒ½
- **é…å¥—æ–‡ä»¶**: ç”Ÿæˆéƒ¨ç½²è„šæœ¬å’Œé…ç½®æ–‡ä»¶

**ç”Ÿæˆç¤ºä¾‹**:
```sql
-- é”™é¢˜æœ¬ä¿®æ­£è®°å½•å®æ—¶å®½è¡¨
-- å®æ—¶å¤„ç†é”™é¢˜ä¿®æ­£è®°å½•ï¼Œç”Ÿæˆå®½è¡¨æ•°æ®
-- Generated by Flink AI Generator

INSERT INTO dwd_wrong_record_wide_delta
SELECT
    CAST(payload.id AS BIGINT) AS id,
    wqr.id AS wrong_id,
    wqr.user_id,
    wqr.subject,
    CASE wqr.subject 
        WHEN 'ENGLISH' THEN 'è‹±è¯­'
        WHEN 'MATH' THEN 'æ•°å­¦'
        -- ...
    END AS subject_name,
    pt.name AS pattern_name,
    TO_TIMESTAMP_LTZ(payload.submit_time, 0) AS fix_time
FROM biz_statistic_wrongbook be
LEFT JOIN wrong_question_record AS wqr 
    ON payload.originWrongRecordId = wqr.id 
    AND payload.isDelete = 0
LEFT JOIN tower_pattern AS pt 
    ON wqr.pattern_id = pt.id
WHERE domain = 'wrongbook' 
  AND type = 'wrongbook_fix';
```

### ğŸ“Š ERå›¾çŸ¥è¯†åº“ç®¡ç†

- **è‡ªåŠ¨æå–**: ä»è¾“å…¥æ–‡ä»¶æå–ERå…³ç³»
- **å†²çªæ£€æµ‹**: æ£€æµ‹è¡¨ç»“æ„å’Œå…³ç³»å†²çª
- **çŸ¥è¯†åº“æ›´æ–°**: æŒç»­ç»´æŠ¤ä¼ä¸šERå›¾
- **å¯è§†åŒ–**: ç”ŸæˆMermaidã€PlantUMLæ ¼å¼å›¾è¡¨

**ERå›¾ç¤ºä¾‹**:
```mermaid
erDiagram
    wrongbook_fix {
        string id PK
        string originWrongRecordId FK
        string userId
        integer result
    }
    
    wrong_question_record {
        string id PK
        string pattern_id FK
        string subject
    }
    
    wrongbook_fix }o--|| wrong_question_record : "originWrongRecordId->id"
```

### ğŸ” æ•°æ®è´¨é‡éªŒè¯

- **è¯­æ³•æ£€æŸ¥**: SQLè¯­æ³•å’ŒFlinkç‰¹æ€§éªŒè¯
- **ç»“æ„éªŒè¯**: è¡¨ç»“æ„å’Œå­—æ®µæ˜ å°„æ£€æŸ¥
- **æ€§èƒ½åˆ†æ**: JOINæ€§èƒ½å’Œèµ„æºä½¿ç”¨è¯„ä¼°
- **æŠ¥å‘Šç”Ÿæˆ**: HTMLã€JSONã€Markdownå¤šæ ¼å¼æŠ¥å‘Š

**éªŒè¯æŠ¥å‘Š**:
- âœ… è¯­æ³•æ£€æŸ¥: é€šè¿‡
- âœ… ç»“æ„éªŒè¯: é€šè¿‡  
- ğŸ“Š æ•°æ®è´¨é‡: 4/5 é€šè¿‡
- ğŸ¯ æ€§èƒ½è¯„åˆ†: 85/100

## ğŸ“‚ è¾“å‡ºç»“æ„

```
build/flink-ai-output/wrongbook/
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ wrongbook_wide_table.sql          # Flink SQLæ–‡ä»¶
â”œâ”€â”€ deployment/
â”‚   â””â”€â”€ deploy-wrongbook.sh               # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ config/
â”‚   â””â”€â”€ wrongbook-job-config.yaml         # ä½œä¸šé…ç½®
â””â”€â”€ validation/
    â”œâ”€â”€ validation-report.html            # éªŒè¯æŠ¥å‘Š
    â”œâ”€â”€ validation-summary.json           # éªŒè¯æ‘˜è¦
    â””â”€â”€ performance-analysis.md           # æ€§èƒ½åˆ†æ

er-knowledge-base/
â”œâ”€â”€ er-knowledge-base.md                  # ä¸»çŸ¥è¯†åº“
â”œâ”€â”€ conflicts.md                          # å†²çªæŠ¥å‘Š
â””â”€â”€ diagrams/
    â”œâ”€â”€ enhanced-er-diagram.mermaid       # Mermaid ERå›¾
    â”œâ”€â”€ enhanced-er-diagram.puml          # PlantUML ERå›¾
    â””â”€â”€ er-analysis-report.md             # åˆ†ææŠ¥å‘Š
```

## ğŸ› ï¸ é«˜çº§é…ç½®

### è‡ªå®šä¹‰ä»»åŠ¡

```gradle
// ç‰¹å®šåŸŸç”Ÿæˆä»»åŠ¡
task generateWrongbookFlinkSql(type: com.flink.ai.FlinkAiWorkflowTask) {
    requestFile = file('job/wrongbook/flink-sql-request-v3.md')
    outputDir = layout.buildDirectory.dir('flink-ai-output/wrongbook')
    domain = 'wrongbook'
}

// æ‰¹é‡ç”Ÿæˆä»»åŠ¡
task generateAllFlinkSql {
    dependsOn tasks.matching { task -> 
        task.name.endsWith('FlinkSql')
    }
}
```

### CI/CDé›†æˆ

```yaml
# .github/workflows/flink-ai.yml
name: Flink AI Generation
on: [push, pull_request]

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-java@v3
        with:
          java-version: '17'
      - name: Generate Flink SQL
        run: ./gradlew flinkAiWorkflow
      - name: Upload artifacts
        uses: actions/upload-artifact@v3
        with:
          name: flink-sql-artifacts
          path: build/flink-ai-output/
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å¼€å‘æ•ˆç‡æå‡

- **ä¼ ç»Ÿå¼€å‘**: 2-3å¤©ï¼ˆéœ€æ±‚åˆ†æã€SQLç¼–å†™ã€æµ‹è¯•ã€éƒ¨ç½²ï¼‰
- **AIæ’ä»¶**: 30åˆ†é’Ÿï¼ˆé…ç½®è¾“å…¥æ–‡ä»¶ã€æ‰§è¡Œç”Ÿæˆã€éªŒè¯éƒ¨ç½²ï¼‰
- **æ•ˆç‡æå‡**: **95%+**

### ä»£ç è´¨é‡æå‡

- **è¯­æ³•é”™è¯¯**: å‡å°‘95%
- **æ€§èƒ½é—®é¢˜**: å‡å°‘80%
- **æ ‡å‡†åŒ–ç¨‹åº¦**: æå‡90%

### ç»´æŠ¤æˆæœ¬é™ä½

- **æ–‡æ¡£ç»´æŠ¤**: è‡ªåŠ¨ç”Ÿæˆï¼Œå‡å°‘äººå·¥ç»´æŠ¤
- **çŸ¥è¯†ä¼ æ‰¿**: ERå›¾çŸ¥è¯†åº“ï¼Œé¿å…é‡å¤å»ºè®¾
- **æ•…éšœæ’æŸ¥**: è¯¦ç»†éªŒè¯æŠ¥å‘Šï¼Œå¿«é€Ÿå®šä½é—®é¢˜

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ’ä»¶æ‰¾ä¸åˆ°**
   ```bash
   gradle tasks --group flink-ai
   ```

2. **è¯·æ±‚æ–‡ä»¶è§£æå¤±è´¥**
   - æ£€æŸ¥YAMLæ ¼å¼æ˜¯å¦æ­£ç¡®
   - ç¡®ä¿å­—æ®µæ˜ å°„è¯­æ³•ç¬¦åˆè§„èŒƒ

3. **ERå›¾å†²çª**
   ```bash
   cat er-knowledge-base/conflicts.md
   gradle updateERKnowledgeBase -PforceERUpdate=true
   ```

4. **æ•°æ®éªŒè¯å¤±è´¥**
   ```bash
   open build/flink-ai-output/validation/validation-report.html
   ```

### è°ƒè¯•æ¨¡å¼

```bash
gradle flinkAiWorkflow --info    # è¯¦ç»†æ—¥å¿—
gradle flinkAiWorkflow --debug   # è°ƒè¯•æ—¥å¿—
```

## ğŸ¤ æœ€ä½³å®è·µ

### 1. å›¢é˜Ÿåä½œ

- ä½¿ç”¨ç»Ÿä¸€çš„è¯·æ±‚æ–‡ä»¶æ¨¡æ¿
- å®šæœŸåŒæ­¥ERçŸ¥è¯†åº“
- å»ºç«‹ä»£ç å®¡æŸ¥æµç¨‹
- é›†æˆåˆ°CI/CDæµæ°´çº¿

### 2. ç‰ˆæœ¬æ§åˆ¶

- âœ… æäº¤: è¯·æ±‚æ–‡ä»¶ã€ERçŸ¥è¯†åº“ã€é…ç½®æ–‡ä»¶
- âŒ å¿½ç•¥: ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶ã€ä¸´æ—¶æ–‡ä»¶

### 3. è´¨é‡ä¿éšœ

- è®¾ç½®æ€§èƒ½è¯„åˆ†é˜ˆå€¼ï¼ˆå»ºè®®â‰¥70åˆ†ï¼‰
- å®šæœŸæ›´æ–°ERçŸ¥è¯†åº“
- ç›‘æ§ç”ŸæˆSQLçš„è¿è¡Œæ€§èƒ½

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯¦ç»†ä½¿ç”¨æŒ‡å—](docs/flink-ai-gradle-plugin-guide.md)
- [ERå›¾è®¾è®¡è§„èŒƒ](docs/er-diagram-standards.md)
- [æ•°æ®éªŒè¯è§„åˆ™](docs/data-validation-rules.md)
- [æ€§èƒ½ä¼˜åŒ–æŒ‡å—](docs/performance-optimization.md)

## ğŸ¯ è·¯çº¿å›¾

### v1.1 è®¡åˆ’åŠŸèƒ½
- [ ] æ”¯æŒæ›´å¤šFlink SQLç‰¹æ€§
- [ ] å¢å¼ºæ€§èƒ½åˆ†æèƒ½åŠ›
- [ ] æ”¯æŒè‡ªå®šä¹‰éªŒè¯è§„åˆ™
- [ ] é›†æˆæ›´å¤šæ•°æ®æºç±»å‹

### v2.0 æ„¿æ™¯
- [ ] AIé©±åŠ¨çš„SQLä¼˜åŒ–å»ºè®®
- [ ] å®æ—¶æ€§èƒ½ç›‘æ§é›†æˆ
- [ ] å¯è§†åŒ–å¼€å‘ç•Œé¢
- [ ] å¤šè¯­è¨€æ”¯æŒ

## ğŸ“§ æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·ï¼š

1. æŸ¥çœ‹ [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤)
2. æœç´¢ [Issues](https://github.com/your-org/flink-ai-plugin/issues)
3. æäº¤æ–°çš„ [Issue](https://github.com/your-org/flink-ai-plugin/issues/new)

---

**è®©Flink SQLå¼€å‘å˜å¾—ç®€å•ã€é«˜æ•ˆã€æ ‡å‡†åŒ–ï¼** ğŸš€
