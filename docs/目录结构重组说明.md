# 目录结构重组说明

## 📋 概述

根据用户要求，已将项目目录结构按照topic场景重新组织，并调整了智能作业生成器规则，确保输出完整的业务解决方案。

## 🏗️ 新的目录结构

### 1. Topic分类目录
```
topics/
├── wrongbook/                    # 错题本业务
│   ├── sql/                      # SQL作业文件
│   │   └── wrongbook_wide_table_hybrid.sql
│   ├── docs/                     # 文档文件
│   │   ├── DataStream API部署说明.md
│   │   ├── 错题本Payload数据结构说明.md
│   │   └── 错题本Flink SQL作业配置说明.md
│   └── java/                     # Java源码（已移至src目录）
└── user/                         # 用户行为业务（预留）
    ├── sql/
    ├── docs/
    └── java/
```

### 2. Java包结构重组
```
src/main/java/com/flink/realtime/topics/
├── wrongbook/                    # 错题本业务包
│   ├── app/
│   │   └── WrongbookWideTableApp.java          # 主应用类
│   ├── bean/
│   │   └── WrongbookPayload.java               # Payload数据结构
│   └── processor/
│       ├── WrongbookAddProcessor.java          # 错题添加处理器
│       └── WrongbookFixProcessor.java          # 错题订正处理器
└── user/                         # 用户行为业务包（预留）
    ├── app/
    ├── bean/
    └── processor/
```

## 📦 文件迁移清单

### 已迁移的文件

#### SQL文件
- ✅ `sql/wrongbook_wide_table_hybrid.sql` → `topics/wrongbook/sql/`

#### 文档文件
- ✅ `docs/错题本Payload数据结构说明.md` → `topics/wrongbook/docs/`
- ✅ `docs/错题本Flink SQL作业配置说明.md` → `topics/wrongbook/docs/`
- ✅ 新增 `topics/wrongbook/docs/DataStream API部署说明.md`

#### Java文件
- ✅ `src/main/java/com/flink/realtime/bean/WrongbookPayload.java` → `src/main/java/com/flink/realtime/topics/wrongbook/bean/`
- ✅ `src/main/java/com/flink/realtime/processor/impl/WrongbookAddProcessor.java` → `src/main/java/com/flink/realtime/topics/wrongbook/processor/`
- ✅ `src/main/java/com/flink/realtime/processor/impl/WrongbookFixProcessor.java` → `src/main/java/com/flink/realtime/topics/wrongbook/processor/`
- ✅ 新增 `src/main/java/com/flink/realtime/topics/wrongbook/app/WrongbookWideTableApp.java`

### 包声明更新
- ✅ 更新所有Java文件的包声明
- ✅ 修复import语句引用
- ✅ 验证编译通过

## 🔧 智能作业生成器规则调整

### 1. 新增目录结构规范
```markdown
## 目录结构规范
```
topics/{topic_name}/
├── sql/
│   └── {topic_name}_wide_table_hybrid.sql     # Flink SQL作业
├── docs/
│   ├── DataStream API部署说明.md              # DataStream API部署文档
│   ├── {topic_name}Payload数据结构说明.md     # Payload文档
│   └── {topic_name}Flink SQL作业配置说明.md   # SQL作业文档
└── java/                                      # Java源码（已移至src目录）
```

## Java包结构规范
```
com.flink.realtime.topics.{topic_name}
├── app
│   └── {TopicName}WideTableApp.java          # 主应用类
├── bean
│   └── {TopicName}Payload.java               # Payload数据结构
└── processor
    ├── {TopicName}AddProcessor.java          # 添加事件处理器
    └── {TopicName}FixProcessor.java          # 订正事件处理器
```
```

### 2. 新增输出要求
- ✅ **Payload数据结构**：必须包含完整的字段定义、JSON注解、getter/setter方法
- ✅ **DataStream API作业**：必须支持动态路由、热部署、故障隔离
- ✅ **Flink SQL作业**：必须包含完整的表定义、业务逻辑、监控视图
- ✅ **部署文档**：必须包含配置管理、部署步骤、监控告警、运维操作

### 3. 文件命名规范
- SQL文件：`{topic_name}_wide_table_hybrid.sql`
- Java类：`{TopicName}WideTableApp.java`、`{TopicName}Payload.java`
- 文档文件：`{topic_name}Payload数据结构说明.md`、`DataStream API部署说明.md`

## 🎯 规则生效验证

### 1. 错题本业务完整解决方案

#### ✅ Payload数据结构
- **文件位置**: `src/main/java/com/flink/realtime/topics/wrongbook/bean/WrongbookPayload.java`
- **包含内容**: 
  - WrongbookAddPayload（错题添加事件）
  - WrongbookFixPayload（错题订正事件）
  - WrongbookDeletePayload（错题删除事件）
  - 完整的JSON注解和getter/setter方法

#### ✅ DataStream API作业
- **文件位置**: `src/main/java/com/flink/realtime/topics/wrongbook/app/WrongbookWideTableApp.java`
- **支持特性**:
  - 动态路由配置
  - 热部署机制
  - 故障隔离策略
  - 监控告警体系

#### ✅ Flink SQL作业
- **文件位置**: `topics/wrongbook/sql/wrongbook_wide_table_hybrid.sql`
- **包含内容**:
  - 完整的表结构定义
  - 业务逻辑处理
  - 监控视图
  - 性能优化配置

#### ✅ 部署说明文档
- **DataStream API部署说明**: `topics/wrongbook/docs/DataStream API部署说明.md`
- **Payload数据结构说明**: `topics/wrongbook/docs/错题本Payload数据结构说明.md`
- **Flink SQL作业配置说明**: `topics/wrongbook/docs/错题本Flink SQL作业配置说明.md`

### 2. 编译验证
- ✅ 所有Java文件编译通过
- ✅ 包声明和import语句正确
- ✅ 无编译错误

## 🚀 使用指南

### 1. 新增业务Topic
```bash
# 创建新的topic目录结构
mkdir -p topics/{new_topic}/{sql,docs,java}

# 创建Java包结构
mkdir -p src/main/java/com/flink/realtime/topics/{new_topic}/{app,bean,processor}
```

### 2. 使用智能作业生成器
当提供新的业务场景时，智能作业生成器将自动：
1. 按照topic分类创建目录结构
2. 生成对应的Java包结构
3. 输出完整的业务解决方案
4. 包含所有必要的文档

### 3. 文件命名规范
- Topic名称使用小写：`wrongbook`、`user`、`order`
- Java类名使用驼峰：`WrongbookWideTableApp`、`UserBehaviorApp`
- 文档文件名使用中文描述

## 📝 最佳实践

### 1. 目录组织
- 按业务topic分类，便于管理和维护
- 每个topic包含完整的解决方案
- 文档和代码分离，便于版本控制

### 2. 包结构设计
- 按功能模块分包：app、bean、processor
- 包名使用小写，类名使用驼峰
- 保持包结构的层次清晰

### 3. 文档管理
- 每个topic包含完整的文档集
- 文档按功能分类：部署、配置、数据结构
- 保持文档的及时更新

## 📚 相关文档

- [项目架构说明](./架构介绍.md)
- [开发规范](./开发规范.md)
- [智能作业生成器规则](../.cursor/rules/intelligent-job-generator.mdc)
- [错题本业务文档](./topics/wrongbook/docs/)
